# markdown-auth
Markdown source editor using Serverless technology.


* `s3` to serve Static HTML
* `Lambda` to convert Markdown to HTML
* `Cognito` for Authentication
* `Cloudformation` to build resources
* es6
* webpack
* angular
* [cognito-identity-js](https://github.com/aws/amazon-cognito-identity-js)


## Setup
Create the cloudformation stack

    $ ./stack/scripts/create

**!NOTE** *- Not all the resources needed are supported by cloudformation (eg cognito).*


## Required ENV variables
`.envrc`
```.envrc
export stack='markdown-tatum'
export sourceBucket="markdown-tatum-author",
export targetBucket="markdown-tatum-site",
export region="us-east-1"
```


## Deploy the /lambda

    $ cd lambda
    $ npm run deploy


## Admin site
[http://markdown-tatum-author.s3-website-us-east-1.amazonaws.com/#/account/login](http://markdown-tatum-author.s3-website-us-east-1.amazonaws.com/#/account/login)


http://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-tokens-with-identity-providers.html



Get Kids:

    https://cognito-idp.us-east-1.amazonaws.com/us-east-1_BGU9CKFCM/.well-known/jwks.json


    https://cognito-idp.us-east-1.amazonaws.com/us-east-1_BGU9CKFCM/.well-known/openid-configuration


{"authorization_endpoint":"https://cognito-idp.us-east-1.amazonaws.com/us-east-1_BGU9CKFCM","id_token_signing_alg_values_supported":["RS256"],"issuer":"https://cognito-idp.us-east-1.amazonaws.com/us-east-1_BGU9CKFCM","jwks_uri":"https://cognito-idp.us-east-1.amazonaws.com/us-east-1_BGU9CKFCM/.well-known/jwks.json","response_types_supported":["code","id_token","token id_token","none"],"subject_types_supported":["public"]}


```json
{"keys":[{"alg":"RS256","e":"AQAB","kid":"vyVQH7UMjwYboVvyFf+zd4KHZfgc+RtmU/A2vHhgITI=","kty":"RSA","n":"xXq59Wi8x2U1lkaaYIeYEHU2rvhk0DjG71mQpqoKKPlJbtdDNzlG1uGqzXlBD5oC6oXire6dvUilDCUm2oZJ-uDd2ZRkPgrsCeQ8qKZUaMD4927BsRAYrHXThSGD2EO1RUKwPO5-05fGdbtxGplHbHti-QuoAQWna31yuH-J7XAdBuEeA0qjJpxmHPYhS_CpMHwsVhBX8aiKhP50jhQ6GYpc0oXAWKyH41tIulvTIG6RnzCbolJREd7PXmKpHnHvVDo4LESovWb4sEC6q4oNxSzUtyYjHWZODVoSFxU44z4ljfBHdaESl-io_ilHJnJb3THI7RX3qD2o_nUjhxSpow","use":"sig"},{"alg":"RS256","e":"AQAB","kid":"fUyIG0h6R5HFGfHDV8uebcRXldQ09dCZXbFKf6zy1rs=","kty":"RSA","n":"m3hoD5oKJq0208qHXVz2swznfFVeU5zWZhAiLKb0hs0bXYN2W9Gy7XklIjibN6ilOaHkL_tvgO_dSKLGJUemr_EVbRrbgu7dENDYgZwYr1CPMy146TIUFeZpqHF1Xh8BF_p7heGeVIP-HjIRgxwG81sknpeQRmxwozrnbbGySJoHClh_EP14z2C1NwSIB4xSFb6r1IOIIuy8vsYVkHd_IRGTK1cCX8f4iuzJ9cBQ1XnppkVGWlcW-m8aF0eDJb6gTK3jieHRqWTfd4I8S5qti6OK61pIlxp1JfJ8ZKgV1k7RDkyVXtA7U49RhBCLXzVdWi1X_SuQwjVMnnkvpo0O_w","use":"sig"}]}
```

## NOTES

Cognito

[x] - Cors policy for the s3 bucket
[ ] - Cognito -> s3 permission
[ ] - S3 Lambda Trigger
